<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Performance Shared Storage Solution for RStudio Server</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #007acc;
        }

        .header h1 {
            color: #007acc;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.2em;
            font-style: italic;
        }

        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #007acc;
        }

        .toc h2 {
            color: #007acc;
            margin-bottom: 15px;
        }

        .toc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .toc a {
            color: #0056b3;
            text-decoration: none;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .toc a:hover {
            background-color: #e3f2fd;
            text-decoration: underline;
        }

        h1 {
            color: #007acc;
            font-size: 2.2em;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #007acc;
        }

        h2 {
            color: #0056b3;
            font-size: 1.8em;
            margin: 25px 0 15px 0;
            padding-left: 15px;
            border-left: 4px solid #007acc;
        }

        h3 {
            color: #333;
            font-size: 1.4em;
            margin: 20px 0 10px 0;
            padding: 10px;
            background: #f1f8ff;
            border-radius: 5px;
        }

        .solution-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #007acc;
        }

        .solution-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .solution-header .icon {
            font-size: 2em;
        }

        .solution-header h3 {
            margin: 0;
            background: none;
            padding: 0;
            color: #007acc;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }

        .pros, .cons {
            padding: 15px;
            border-radius: 8px;
        }

        .pros {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 4px solid #28a745;
        }

        .cons {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-left: 4px solid #dc3545;
        }

        .highlight-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #f1f8ff 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3e0 0%, #ffeaa7 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }

        .success-box {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }

        .architecture-diagram {
            background: white;
            border: 2px solid #007acc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-family: monospace;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.4;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .bash {
            background: #1a202c;
        }

        .code-title {
            background: #495057;
            color: white;
            padding: 8px 15px;
            border-radius: 5px 5px 0 0;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 0;
        }

        .code-title + pre {
            margin-top: 0;
            border-radius: 0 0 8px 8px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table th {
            background: linear-gradient(135deg, #007acc 0%, #0056b3 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin: 2px;
        }

        .badge-recommended {
            background: #d4edda;
            color: #155724;
        }

        .badge-performance {
            background: #fff3cd;
            color: #856404;
        }

        .badge-complex {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-simple {
            background: #d1ecf1;
            color: #0c5460;
        }

        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin-bottom: 8px;
        }

        .step-number {
            background: #007acc;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .step-container {
            display: flex;
            align-items: flex-start;
            margin: 20px 0;
        }

        .step-content {
            flex: 1;
        }

        @media (max-width: 768px) {
            .pros-cons {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>High-Performance Shared Storage</h1>
            <div class="subtitle">Complete Solution for RStudio Server Docker Container</div>
        </div>

        <div class="toc">
            <h2>📋 Solution Overview</h2>
            <div class="toc-grid">
                <a href="#architecture">📐 Architecture Overview</a>
                <a href="#solutions">🔧 Storage Solutions</a>
                <a href="#recommended">⭐ Recommended Approach</a>
                <a href="#implementation">🚀 Implementation Steps</a>
                <a href="#configuration">⚙️ Container Configuration</a>
                <a href="#testing">🧪 Testing & Validation</a>
                <a href="#management">📊 Management & Monitoring</a>
                <a href="#troubleshooting">🔍 Troubleshooting</a>
            </div>
        </div>

        <section id="architecture">
            <h1><span class="emoji">📐</span>Architecture Overview</h1>
            
            <div class="highlight-box">
                <h3>Current Situation</h3>
                <ul>
                    <li><strong>Container Storage</strong>: Workspaces stored in <code>/home/cdsw/test_workspace</code></li>
                    <li><strong>Users</strong>: cdsw (admin), dev1, dev2 with isolated home directories</li>
                    <li><strong>Challenge</strong>: Need high-performance RAID storage accessible to all users</li>
                    <li><strong>Goal</strong>: Shared workspace area on fast storage for data-intensive operations</li>
                </ul>
            </div>

            <div class="architecture-diagram">
                <h3>Proposed Architecture</h3>
                <pre>
┌─────────────────────────────────────────────────────────────────┐
│                     HOST SYSTEM                                 │
│                                                                 │
│  ┌─────────────────┐         ┌─────────────────────────────┐   │
│  │   RAID Storage  │         │      Docker Container      │   │
│  │  /data/raid/    │◄────────┤    RStudio Server          │   │
│  │                 │  mount  │                             │   │
│  │  - High Speed   │         │  /shared/workspaces/       │   │
│  │  - Large Size   │         │  ├── cdsw/                 │   │
│  │  - Redundancy   │         │  ├── dev1/                 │   │
│  │                 │         │  ├── dev2/                 │   │
│  └─────────────────┘         │  └── common/               │   │
│                               │                             │   │
│                               │  /home/                     │   │
│                               │  ├── cdsw/                 │   │
│                               │  ├── dev1/                 │   │
│                               │  └── dev2/                 │   │
│                               └─────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                </pre>
            </div>
        </section>

        <section id="solutions">
            <h1><span class="emoji">🔧</span>Storage Solutions Comparison</h1>

            <div class="solution-card">
                <div class="solution-header">
                    <span class="icon">🗂️</span>
                    <h3>Solution 1: Docker Volume Mount</h3>
                    <span class="badge badge-recommended">RECOMMENDED</span>
                </div>
                <p><strong>Mount host RAID storage directly into container using Docker volumes.</strong></p>
                
                <div class="pros-cons">
                    <div class="pros">
                        <h4>✅ Advantages</h4>
                        <ul>
                            <li>Simple and straightforward</li>
                            <li>Direct file system access</li>
                            <li>No performance overhead</li>
                            <li>Native Docker feature</li>
                            <li>Persistent across container restarts</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>❌ Considerations</h4>
                        <ul>
                            <li>Requires container restart</li>
                            <li>Host path dependency</li>
                            <li>Need proper permissions setup</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="solution-card">
                <div class="solution-header">
                    <span class="icon">🔗</span>
                    <h3>Solution 2: Bind Mount</h3>
                    <span class="badge badge-simple">SIMPLE</span>
                </div>
                <p><strong>Directly bind mount host directory to container path.</strong></p>
                
                <div class="pros-cons">
                    <div class="pros">
                        <h4>✅ Advantages</h4>
                        <ul>
                            <li>Immediate access to host files</li>
                            <li>Real-time synchronization</li>
                            <li>No Docker volume management</li>
                            <li>Direct host path control</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>❌ Considerations</h4>
                        <ul>
                            <li>Tight coupling to host paths</li>
                            <li>Security implications</li>
                            <li>Platform-specific paths</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="solution-card">
                <div class="solution-header">
                    <span class="icon">🌐</span>
                    <h3>Solution 3: Network Storage (NFS/CIFS)</h3>
                    <span class="badge badge-performance">HIGH PERFORMANCE</span>
                </div>
                <p><strong>Mount network-attached storage (NFS/CIFS) into container.</strong></p>
                
                <div class="pros-cons">
                    <div class="pros">
                        <h4>✅ Advantages</h4>
                        <ul>
                            <li>Scalable across multiple hosts</li>
                            <li>Centralized storage management</li>
                            <li>Flexible access controls</li>
                            <li>High availability options</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>❌ Considerations</h4>
                        <ul>
                            <li>Network latency</li>
                            <li>Complex setup</li>
                            <li>Additional infrastructure</li>
                            <li>Network dependencies</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="solution-card">
                <div class="solution-header">
                    <span class="icon">🔄</span>
                    <h3>Solution 4: Symbolic Links</h3>
                    <span class="badge badge-complex">RUNTIME</span>
                </div>
                <p><strong>Create symbolic links from container to mounted storage.</strong></p>
                
                <div class="pros-cons">
                    <div class="pros">
                        <h4>✅ Advantages</h4>
                        <ul>
                            <li>No container restart needed</li>
                            <li>Flexible directory structure</li>
                            <li>Can mix local and external storage</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>❌ Considerations</h4>
                        <ul>
                            <li>Links can break</li>
                            <li>More complex management</li>
                            <li>Potential permission issues</li>
                        </ul>
                    </div>
                </div>
            </div>

            <table class="comparison-table">
                <tr>
                    <th>Solution</th>
                    <th>Performance</th>
                    <th>Complexity</th>
                    <th>Scalability</th>
                    <th>Use Case</th>
                </tr>
                <tr>
                    <td><strong>Docker Volume Mount</strong></td>
                    <td>🟢 Excellent</td>
                    <td>🟢 Low</td>
                    <td>🟡 Medium</td>
                    <td>Single host RAID</td>
                </tr>
                <tr>
                    <td><strong>Bind Mount</strong></td>
                    <td>🟢 Excellent</td>
                    <td>🟢 Low</td>
                    <td>🔴 Low</td>
                    <td>Development/Testing</td>
                </tr>
                <tr>
                    <td><strong>Network Storage</strong></td>
                    <td>🟡 Good</td>
                    <td>🔴 High</td>
                    <td>🟢 Excellent</td>
                    <td>Multi-host clusters</td>
                </tr>
                <tr>
                    <td><strong>Symbolic Links</strong></td>
                    <td>🟢 Excellent</td>
                    <td>🟡 Medium</td>
                    <td>🟡 Medium</td>
                    <td>Dynamic allocation</td>
                </tr>
            </table>
        </section>

        <section id="recommended">
            <h1><span class="emoji">⭐</span>Recommended Solution: Docker Volume Mount</h1>
            
            <div class="success-box">
                <h3>Why Docker Volume Mount?</h3>
                <p>For your use case with RAID storage on a single host serving multiple RStudio users, Docker volume mounting provides the best balance of:</p>
                <ul>
                    <li><strong>Performance</strong>: Direct file system access, no virtualization overhead</li>
                    <li><strong>Simplicity</strong>: Standard Docker feature, well-documented</li>
                    <li><strong>Reliability</strong>: Persistent across container lifecycles</li>
                    <li><strong>Security</strong>: Controlled access through Docker and filesystem permissions</li>
                </ul>
            </div>

            <h2>Proposed Directory Structure</h2>
            <div class="architecture-diagram">
                <pre>
HOST RAID STORAGE: /data/raid/rstudio/
├── workspaces/
│   ├── cdsw/                    # Admin user workspace
│   │   ├── projects/
│   │   ├── data/
│   │   └── shared/
│   ├── dev1/                    # Developer 1 workspace
│   │   ├── projects/
│   │   └── data/
│   ├── dev2/                    # Developer 2 workspace
│   │   ├── projects/
│   │   └── data/
│   └── common/                  # Shared area for all users
│       ├── datasets/
│       ├── libraries/
│       └── templates/
├── backups/                     # Automated backups
└── temp/                        # Temporary workspace

CONTAINER MOUNT POINT: /shared/workspaces/
├── cdsw/          → /data/raid/rstudio/workspaces/cdsw/
├── dev1/          → /data/raid/rstudio/workspaces/dev1/
├── dev2/          → /data/raid/rstudio/workspaces/dev2/
└── common/        → /data/raid/rstudio/workspaces/common/
                </pre>
            </div>

            <h2>Storage Benefits</h2>
            <div class="highlight-box">
                <h3>🚀 Performance Advantages</h3>
                <ul>
                    <li><strong>RAID Speed</strong>: Direct access to high-speed RAID arrays</li>
                    <li><strong>Large Datasets</strong>: Handle multi-GB datasets efficiently</li>
                    <li><strong>Parallel I/O</strong>: Multiple users can work simultaneously</li>
                    <li><strong>No Bottlenecks</strong>: Bypass container filesystem layers</li>
                </ul>
                
                <h3>📊 Data Management</h3>
                <ul>
                    <li><strong>Centralized Storage</strong>: All user data in one location</li>
                    <li><strong>Easy Backups</strong>: Single backup point for all workspaces</li>
                    <li><strong>Shared Resources</strong>: Common datasets and libraries</li>
                    <li><strong>Persistent Data</strong>: Survives container updates/rebuilds</li>
                </ul>
            </div>
        </section>

        <section id="implementation">
            <h1><span class="emoji">🚀</span>Complete Implementation Guide</h1>

            <h2>Phase 1: Host Storage Preparation</h2>
            
            <div class="step-container">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>Create RAID Storage Structure</h3>
                    <div class="code-title">Host Terminal Commands</div>
                    <pre class="bash"># Create main directory structure on RAID storage
sudo mkdir -p /data/raid/rstudio/{workspaces/{cdsw,dev1,dev2,common},backups,temp}

# Create subdirectories for each user
sudo mkdir -p /data/raid/rstudio/workspaces/cdsw/{projects,data,shared}
sudo mkdir -p /data/raid/rstudio/workspaces/dev1/{projects,data}
sudo mkdir -p /data/raid/rstudio/workspaces/dev2/{projects,data}
sudo mkdir -p /data/raid/rstudio/workspaces/common/{datasets,libraries,templates}</pre>
                </div>
            </div>

            <div class="step-container">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>Set Proper Permissions</h3>
                    <div class="code-title">Permission Setup</div>
                    <pre class="bash"># Set ownership to match container UIDs
sudo chown -R 8536:8536 /data/raid/rstudio/workspaces/cdsw/
sudo chown -R 8537:8537 /data/raid/rstudio/workspaces/dev1/
sudo chown -R 8538:8538 /data/raid/rstudio/workspaces/dev2/
sudo chown -R 8536:8536 /data/raid/rstudio/workspaces/common/

# Set permissions for shared access
sudo chmod 755 /data/raid/rstudio/workspaces/
sudo chmod 775 /data/raid/rstudio/workspaces/common/
sudo chmod 755 /data/raid/rstudio/workspaces/{cdsw,dev1,dev2}/</pre>
                </div>
            </div>

            <div class="step-container">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>Test Storage Performance</h3>
                    <div class="code-title">Performance Testing</div>
                    <pre class="bash"># Test write performance
dd if=/dev/zero of=/data/raid/rstudio/test_file bs=1M count=1000 oflag=direct

# Test read performance  
dd if=/data/raid/rstudio/test_file of=/dev/null bs=1M iflag=direct

# Cleanup test file
rm /data/raid/rstudio/test_file</pre>
                </div>
            </div>

            <h2>Phase 2: Container Configuration</h2>

            <div class="step-container">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h3>Stop Current Container</h3>
                    <div class="code-title">Container Management</div>
                    <pre class="bash"># Stop current container
docker stop rstudio-server

# Optional: Remove to start fresh
docker rm rstudio-server</pre>
                </div>
            </div>

            <div class="step-container">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h3>Launch with Volume Mount</h3>
                    <div class="code-title">Enhanced Docker Run Command</div>
                    <pre class="bash">docker run -d \
  --name=rstudio-server \
  --memory=28g \
  -p 8787:8787 \
  -v /data/raid/rstudio/workspaces:/shared/workspaces:rw \
  -v /data/raid/rstudio/backups:/shared/backups:rw \
  -v /data/raid/rstudio/temp:/shared/temp:rw \
  --restart=unless-stopped \
  peterableda/rstudio-cloudera-runtime:2025.05-r4.5.1</pre>
                </div>
            </div>

            <div class="step-container">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h3>Create Symbolic Links (Optional)</h3>
                    <div class="code-title">User-Friendly Access Links</div>
                    <pre class="bash"># Create convenience links in user home directories
docker exec -u cdsw rstudio-server bash -c "
ln -sf /shared/workspaces/cdsw /home/cdsw/workspace
ln -sf /shared/workspaces/common /home/cdsw/shared
"

docker exec -u dev1 rstudio-server bash -c "
ln -sf /shared/workspaces/dev1 /home/dev1/workspace  
ln -sf /shared/workspaces/common /home/dev1/shared
"

docker exec -u dev2 rstudio-server bash -c "
ln -sf /shared/workspaces/dev2 /home/dev2/workspace
ln -sf /shared/workspaces/common /home/dev2/shared
"</pre>
                </div>
            </div>

            <h2>Phase 3: RStudio Configuration</h2>

            <div class="step-container">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h3>Update Default Working Directories</h3>
                    <div class="code-title">RStudio Session Configuration</div>
                    <pre class="bash"># Create startup script for each user
docker exec rstudio-server bash -c "
cat > /etc/rstudio/rsession.conf << 'EOF'
# Default working directory for new sessions
session-default-working-dir=/shared/workspaces
session-default-new-project-dir=/shared/workspaces
EOF
"</pre>
                </div>
            </div>

            <div class="step-container">
                <div class="step-number">8</div>
                <div class="step-content">
                    <h3>Create Welcome Workspace</h3>
                    <div class="code-title">Initial Setup Script</div>
                    <pre class="bash"># Create welcome content for each user
docker exec rstudio-server bash -c "
# CDSW user setup
cat > /shared/workspaces/cdsw/README.md << 'EOF'
# CDSW Workspace

Welcome to your high-performance workspace!

## Directory Structure
- \`projects/\` - Your R projects and analyses
- \`data/\` - Personal datasets and files  
- \`shared/\` - Files shared with other users

## Shared Resources
- \`/shared/workspaces/common/\` - Shared datasets and libraries
- \`/shared/temp/\` - Temporary workspace for large operations

## Performance Tips
- Use this workspace for large datasets (>1GB)
- Save intermediate results here for faster access
- Use shared datasets to avoid duplication
EOF

# Similar setup for dev1 and dev2...
"</pre>
                </div>
            </div>
        </section>

        <section id="configuration">
            <h1><span class="emoji">⚙️</span>Advanced Configuration Options</h1>

            <h2>Docker Compose Alternative</h2>
            <div class="highlight-box">
                <p>For easier management, you can use Docker Compose:</p>
                <div class="code-title">docker-compose.yml</div>
                <pre>version: '3.8'

services:
  rstudio-server:
    image: peterableda/rstudio-cloudera-runtime:2025.05-r4.5.1
    container_name: rstudio-server
    ports:
      - "8787:8787"
    volumes:
      - /data/raid/rstudio/workspaces:/shared/workspaces:rw
      - /data/raid/rstudio/backups:/shared/backups:rw
      - /data/raid/rstudio/temp:/shared/temp:rw
    mem_limit: 28g
    restart: unless-stopped
    environment:
      - RSTUDIO_SHARED_STORAGE=true
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8787"]
      interval: 30s
      timeout: 10s
      retries: 3</pre>
            </div>

            <h2>Performance Tuning</h2>
            <div class="solution-card">
                <div class="solution-header">
                    <span class="icon">⚡</span>
                    <h3>Storage Optimization</h3>
                </div>
                <div class="code-title">Mount Options for Performance</div>
                <pre class="bash"># For maximum performance, add mount options
docker run -d \
  --name=rstudio-server \
  --memory=28g \
  -p 8787:8787 \
  -v /data/raid/rstudio/workspaces:/shared/workspaces:rw,Z \
  -v /data/raid/rstudio/temp:/shared/temp:rw,Z,noatime \
  --tmpfs /tmp:rw,noexec,nosuid,size=2g \
  peterableda/rstudio-cloudera-runtime:2025.05-r4.5.1</pre>
            </div>

            <h2>Backup Strategy</h2>
            <div class="warning-box">
                <h3>⚠️ Important: Backup Configuration</h3>
                <p>With high-performance storage, implement regular backups:</p>
                <div class="code-title">Automated Backup Script</div>
                <pre class="bash">#!/bin/bash
# /data/raid/scripts/backup_workspaces.sh

BACKUP_DIR="/data/raid/rstudio/backups/$(date +%Y%m%d_%H%M%S)"
SOURCE_DIR="/data/raid/rstudio/workspaces"

# Create backup directory
mkdir -p "$BACKUP_DIR"

# Backup each user workspace
for user in cdsw dev1 dev2 common; do
    echo "Backing up $user workspace..."
    tar -czf "$BACKUP_DIR/${user}_workspace.tar.gz" \
        -C "$SOURCE_DIR" "$user"
done

# Keep only last 7 days of backups
find /data/raid/rstudio/backups -type d -mtime +7 -exec rm -rf {} \;</pre>
            </div>
        </section>

        <section id="testing">
            <h1><span class="emoji">🧪</span>Testing & Validation</h1>

            <h2>Storage Access Tests</h2>
            <div class="code-title">Validation Commands</div>
            <pre class="bash"># Test 1: Verify mount points
docker exec rstudio-server df -h | grep shared

# Test 2: Check permissions
docker exec rstudio-server ls -la /shared/workspaces/

# Test 3: Test write access for each user
docker exec -u cdsw rstudio-server touch /shared/workspaces/cdsw/test_file
docker exec -u dev1 rstudio-server touch /shared/workspaces/dev1/test_file
docker exec -u dev2 rstudio-server touch /shared/workspaces/dev2/test_file

# Test 4: Performance test
docker exec rstudio-server dd if=/dev/zero of=/shared/workspaces/common/test_perf bs=1M count=100</pre>

            <h2>R Integration Tests</h2>
            <div class="code-title">R Performance Validation</div>
            <pre># Test large dataset handling
docker exec -u cdsw rstudio-server R --slave -e "
# Test workspace performance
setwd('/shared/workspaces/cdsw')

# Create large dataset
large_data <- data.frame(
  id = 1:1000000,
  value1 = rnorm(1000000),
  value2 = runif(1000000),
  category = sample(LETTERS, 1000000, replace = TRUE)
)

# Time saving operation
system.time({
  write.csv(large_data, 'data/large_dataset.csv')
})

# Time loading operation  
system.time({
  loaded_data <- read.csv('data/large_dataset.csv')
})

cat('Dataset size:', format(object.size(large_data), units = 'MB'), '\n')
cat('File size:', file.size('data/large_dataset.csv') / 1024^2, 'MB\n')
"</pre>
        </section>

        <section id="management">
            <h1><span class="emoji">📊</span>Management & Monitoring</h1>

            <h2>Storage Monitoring</h2>
            <div class="code-title">Monitoring Script</div>
            <pre class="bash">#!/bin/bash
# Storage monitoring for RStudio workspaces

echo "=== RStudio Workspace Storage Report ==="
echo "Date: $(date)"
echo

# Overall storage usage
echo "Storage Usage:"
df -h /data/raid/rstudio/

echo
echo "Workspace Sizes:"
for user in cdsw dev1 dev2 common; do
    size=$(du -sh /data/raid/rstudio/workspaces/$user 2>/dev/null | cut -f1)
    echo "  $user: $size"
done

echo
echo "Container Storage Usage:"
docker exec rstudio-server df -h /shared/workspaces/

echo
echo "Active User Sessions:"
docker exec rstudio-server ps aux | grep "rsession"</pre>

            <h2>User Management Commands</h2>
            <div class="code-title">Administrative Commands</div>
            <pre class="bash"># Add new user workspace
create_user_workspace() {
    local username=$1
    local uid=$2
    
    mkdir -p /data/raid/rstudio/workspaces/$username/{projects,data}
    chown -R $uid:$uid /data/raid/rstudio/workspaces/$username/
    chmod 755 /data/raid/rstudio/workspaces/$username/
    
    echo "Created workspace for $username (UID: $uid)"
}

# Usage: create_user_workspace dev3 8539

# Clean temporary files
clean_temp_workspace() {
    find /data/raid/rstudio/temp -type f -mtime +1 -delete
    echo "Cleaned temporary workspace"
}

# Check workspace integrity
check_workspace_permissions() {
    echo "Checking workspace permissions..."
    ls -la /data/raid/rstudio/workspaces/
}</pre>
        </section>

        <section id="troubleshooting">
            <h1><span class="emoji">🔍</span>Troubleshooting Guide</h1>

            <h2>Common Issues & Solutions</h2>

            <div class="warning-box">
                <h3>❌ Issue: Permission Denied</h3>
                <p><strong>Symptoms:</strong> Cannot write to shared workspace</p>
                <p><strong>Solution:</strong></p>
                <pre class="bash"># Check current permissions
ls -la /data/raid/rstudio/workspaces/

# Fix permissions
sudo chown -R 8536:8536 /data/raid/rstudio/workspaces/cdsw/
sudo chown -R 8537:8537 /data/raid/rstudio/workspaces/dev1/
sudo chown -R 8538:8538 /data/raid/rstudio/workspaces/dev2/</pre>
            </div>

            <div class="warning-box">
                <h3>❌ Issue: Mount Point Not Available</h3>
                <p><strong>Symptoms:</strong> /shared/workspaces directory empty</p>
                <p><strong>Solution:</strong></p>
                <pre class="bash"># Check if volume is mounted
docker inspect rstudio-server | grep -A 10 "Mounts"

# Restart container with correct mount
docker stop rstudio-server
docker rm rstudio-server
# Run with proper volume mount command</pre>
            </div>

            <div class="warning-box">
                <h3>❌ Issue: Poor Performance</h3>
                <p><strong>Symptoms:</strong> Slow file operations</p>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Check RAID array health</li>
                    <li>Monitor I/O with <code>iostat</code></li>
                    <li>Verify mount options include <code>noatime</code></li>
                    <li>Check for competing processes</li>
                </ul>
            </div>

            <h2>Diagnostic Commands</h2>
            <div class="code-title">System Diagnostics</div>
            <pre class="bash"># Container status
docker ps -a | grep rstudio

# Volume information
docker volume ls
docker inspect rstudio-server

# Storage performance
iostat -x 1 5

# Network storage (if applicable)
mount | grep nfs
df -t nfs4

# Container logs
docker logs rstudio-server --tail 50</pre>
        </section>

        <section>
            <h1><span class="emoji">✅</span>Implementation Checklist</h1>
            
            <div class="success-box">
                <h3>Pre-Implementation Checklist</h3>
                <ul>
                    <li>☐ RAID storage mounted and accessible</li>
                    <li>☐ Sufficient disk space (recommend 2x expected data size)</li>
                    <li>☐ Backup strategy planned</li>
                    <li>☐ User UIDs identified (8536, 8537, 8538)</li>
                    <li>☐ Current container backed up (if needed)</li>
                </ul>

                <h3>Implementation Checklist</h3>
                <ul>
                    <li>☐ Host directory structure created</li>
                    <li>☐ Permissions set correctly</li>
                    <li>☐ Container stopped and removed</li>
                    <li>☐ New container launched with volume mounts</li>
                    <li>☐ Symbolic links created</li>
                    <li>☐ RStudio configuration updated</li>
                </ul>

                <h3>Post-Implementation Checklist</h3>
                <ul>
                    <li>☐ All users can access their workspaces</li>
                    <li>☐ Shared directory accessible to all</li>
                    <li>☐ Performance testing completed</li>
                    <li>☐ Backup system functional</li>
                    <li>☐ Monitoring setup configured</li>
                    <li>☐ Documentation updated</li>
                </ul>
            </div>
        </section>

        <div class="footer" style="margin-top: 50px; padding-top: 20px; border-top: 2px solid #007acc; text-align: center; color: #666;">
            <p><strong>High-Performance Shared Storage Solution for RStudio Server</strong></p>
            <p>Generated on August 9, 2025 | Ready for Implementation</p>
        </div>
    </div>
</body>
</html>
